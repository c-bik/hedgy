digraph ControllerFSM {
    rankdir = LR;

    subgraph _cluster_500_responses {
        node [shape=box];
        error 500 501 503;
    }

    subgraph _cluster_400_responses {
        node [shape=box];
        400 401 403 404 405 406 409 410 412 413 414 415;
    }

    subgraph _cluster_results {
        node [shape=box];
        nop halt upgrade respond 200 201 204 
        300 301 303 304 307;
    };

    start [shape=Mdiamond]; 
    start -> v3b13;

    v3b13 [label="v3b13\nping"];
    v3b13 -> v3b13b [label = "pong"];
    v3b13 -> 503 [label="!pong"];
    
    v3b13b [label="v3b13b\nservice_available?"];
    v3b13b -> v3b12 [label="true"];
    v3b13b -> 503 [label="false"];

    v3b12 [label="v3b12\nknown_methods"];
    v3b12 -> v3b11 [label = "known method"];
    v3b12 -> 501 [label="unknown method"];

    v3b11 [label="v3b11\nuri_too_long"];
    v3b11 -> v3b10 [label="false"];
    v3b11 -> 414 [label="true"];

    v3b10 [label="v3b10\nallowed_methods"];
    v3b10 -> v3b9 [label="true"]; 
    v3b10 -> 405 [label="false"]; 

    v3b9 [label="v3b9\nmalformed_request"];
    v3b9 -> v3b8 [label="false"];
    v3b9 -> 400 [label="true"];
 
    v3b8 [label="v3b8\nis_authorized"];
    v3b8 -> v3b7;
    v3b8 -> error;
    v3b8 -> halt;
    v3b8 -> 401;

    v3b7 [label="v3b7\nforbidden"]
    v3b7 -> v3b6_upgrade [label="false"];
    v3b7 -> 403 [label="true"];

    v3b6_upgrade -> v3b6;
    v3b6_upgrade -> upgrade;

    v3b6 -> v3b5;
    v3b6 -> 501;

    v3b5 -> v3b4;
    v3b5 -> 415;

    v3b4 -> v3b3;
    v3b4 -> 413;

    v3b3 -> v3c3;
    v3b3 -> 200;

    v3c3 -> v3d4;
    v3c3 -> v3c4;

    v3c4 -> v3d4;
    v3c4 -> 406;

    v3d4 -> v3e5;
    v3d4 -> v3d5;
 
    v3d5 -> v3e5;
    v3d5 -> 406;

    v3e5 -> v3f6;
    v3e5 -> v3e6;
    v3e5 -> 406;

    v3e6 -> v3f6;
    v3e6 -> 406; 
   
    v3f6 -> v3g7;
    v3f6 -> v3f7;
    v3f6 -> 406;

    v3f7 -> v3g7;
    v3f7 -> 406;
 
    v3g7 -> v3g8;
    v3g7 -> v3h7;

    v3g8 -> v3g9;
    v3g8 -> v3h10;

    v3g9 -> v3h10;
    v3g9 -> v3g11;

    v3g11 -> v3h10;

    v3h7 -> v3i7;
    v3h7 -> 412;

    v3h10 -> v3i12;
    v3h10 -> v3h11;
    
    v3h11 -> v3i12;
    v3h11 -> v3h12;

    v3h12 -> v3i12;
    v3h12 -> 412;

    v3i4 -> v3p3;
    v3i4 -> error; 
    v3i4 -> halt; 
    v3i4 -> 301;

    v3i7 -> v3i4;
    v3i7 -> v3k7;

    v3i12 -> v3l13;
    v3i12 -> v3i13;

    v3i13 -> v3j18;
    v3i13 -> v3k13;
 
    v3j18 -> 304;
    v3j18 -> 412;

    v3k5 -> v3l5;
    v3k5 -> error;
    v3k5 -> halt;
    v3k5 -> 301;

    v3k7 -> v3k5;
    v3k7 -> v3l7;

    v3k13 -> v3j18;
    v3k13 -> v3l13;

    v3l5 -> v3m5;
    v3l5 -> error;
    v3l5 -> halt;
    v3l5 -> 307;

    v3l7 -> v3m7;
    v3l7 -> 404;

    v3l13 -> v3m16;
    v3l13 -> v3l14;

    v3l14 -> v3m16;
    v3l14 -> v3l15;

    v3l15 -> v3m16;
    v3l15 -> v3l17;

    v3l17 -> v3m16;
    v3l17 -> 304;

    v3m5 -> v3n5; 
    v3m5 -> 410;

    v3m7 -> v3n11;
    v3m7 -> 404;
 
    v3m16 -> v3m20;
    v3m16 -> v3n16;

    v3m20 -> v3m20b;
    v3m20 -> 500;

    v3m20b -> v3n11;
    v3m20b -> 410;

    v3n5 -> v3n11;
    v3n5 -> 410;
    
    v3n11 -> 500;
    v3n11 -> 303;
    v3n11 -> error;
    v3n11 -> halt;
    v3n11 -> nop;

    v3n16 -> v3n11;
    v3n16 -> v3o16;

    v3o14 -> v3p11;
    v3o14 -> 409;
    v3o14 -> respond;
    v3o14 -> halt;
    v3o14 -> error;

    v3o16 -> v3o14;
    v3o16 -> v3o18;

    v3o18 -> error;
    v3o18 -> halt;
    v3o18 -> respond;
    v3o18 -> v3o18b;
  
    v3o18b -> 200;
    v3o18b -> 300;

    v3o20 -> v3o18;
    v3o20 -> 204;

    v3p3 -> respond;
    v3p3 -> halt;
    v3p3 -> error;
    v3p3 -> 409;
    v3p3 -> v3p11

    v3p11 -> v3o20;
    v3p11 -> 201;
  
    500 [label="500\nInternal Server Error"];
    501 [label="501\nNot Implemented"];
    502 [label="502\nBad Gateway"];
    503 [label="503\nService Unavailable"];
}
